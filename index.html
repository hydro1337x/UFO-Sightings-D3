<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/d3.geo.projection.v0.min.js"></script>
    <script src="https://d3js.org/topojson.v0.min.js"></script>
    <title>UFO Sightings</title>
    <style>
        #map {
            width: 100%;
            height: 100%;
            fill: rgb(38, 42, 49);
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        #tooltip {
            display: none;
            width: 340px;
            position: absolute;
            pointer-events: none;
            background: #fff;
            border: 4px solid #000;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="tooltip"></div>
    <script>
        // Postavljanje mape
        const projection = d3.geo
            .mercator()
            .center([-20, 45])
            .scale(250)
            .rotate([-20, 0])
            .translate([window.innerWidth / 2.1, window.innerHeight / 2.2]);

        const svg = d3
            .select("#map")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%");

        const path = d3.geo.path().projection(projection);
        const g = svg.append("g");

        // Promjer markera
        const radius = 5
        const tooltip = d3.select("#tooltip")

        // inicijalizacija mape
        d3.json("world-110m2.json", (error, topology) => {
            g.selectAll("path")
                .data(topojson.object(topology, topology.objects.countries).geometries)
                .enter()
                .append("path")
                .attr("d", path);
        });

        d3.json("dataset.json", (error, data) => {

            g.selectAll("circle")
                .data(data[2008])
                .enter()
                .append("circle")
                .style("fill", "red")
                .attr("cx", function (d) {
                    return projection([d.longitude, d.latitude])[0];
                })
                .attr("cy", function (d) {
                    return projection([d.longitude, d.latitude])[1];
                })
                .attr("r", radius)
                .attr("class", function (d) {
                    return `${d.datetime}`;
                })
                .on("mouseover", function (d) {
                    d3.select(this).style("fill", "black")
                    tooltip
                        .style("display", "block")
                        .style("left", d3.event.pageX + "px")
                        .style("top", d3.event.pageY - 100 + "px")
                        .text(d.city)
                })
                .on("mouseout", function (d) {
                    tooltip.style("display", "none");
                    d3.select(this)
                        .transition()
                        .style("fill", "red")
                        .duration(1000)
                });
        });

        // zumiranje i pomicanje
        const zoom = d3.behavior.zoom().on("zoom", () => {
            g.attr(
                "transform",
                `translate(${d3.event.translate.join(",")}) scale(${d3.event.scale})`
            )

            // Skaliranje toƒçaka ovisno o scale faktoru
            let scale = d3.event.scale
            console.log(scale)
            if (scale < 100) {
                g.selectAll("circle")
                    .attr("r", radius / scale)
            }
        })
        svg.call(zoom);
    </script>
</body>

</html>